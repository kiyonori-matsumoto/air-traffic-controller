# オートパイロットシステムにおける4次元軌道生成と目標値算出ロジックに関する包括的技術報告書

## 1. 序論：現代航空機における軌道合成の基本概念

現代の航空機運用において、Flight Management System (FMS) およびオートパイロットシステムは、単なる機体制御装置から、極めて高度な4次元（緯度、経度、高度、時間）軌道演算機へと進化を遂げている。各Waypoint（ウェイポイント）における目標値——すなわち高度、速度、および旋回開始点（Turn Start Point）——の算出は、静的なデータベース参照ではなく、機体性能モデル、気象データ、および運航制約を統合した動的な「軌道合成（Trajectory Synthesis）」プロセスによって実行される。

本報告書では、LNAV（水平航法）、VNAV（垂直航法）、およびRTA（要求到着時刻）管理における目標値算出の数理的ロジックとアルゴリズムについて、航空工学および制御理論の観点から詳細に分析を行う。特に、質点モデルを用いた運動方程式の積分、エネルギー管理手法、および制約充足問題（Constraint Satisfaction Problem）としての軌道最適化プロセスに焦点を当てる。

### 1.1 質点モデルと運動方程式

FMSの軌道予測器（Trajectory Predictor: TP）は、航空機を3自由度（3-DOF）または6自由度の質点モデルとして扱い、各計算ステップにおける状態量を予測する。Waypointでの目標値は、以下のエネルギー保存則に基づく総エネルギー（Total Energy）の管理によって導出される。

$$E_{tot} = mgh + \frac{1}{2}mV_{TAS}^2$$

ここで、$m$は機体質量、$g$は重力加速度、$h$は幾何高度、$V_{TAS}$は真対気速度である。このエネルギー状態の時間変化率（Specific Power, $P_s$）は、推力（$T$）と抗力（$D$）のバランスによって決定され、以下の運動方程式が軌道計算の基礎となる。

$$(T - D)V_{TAS} = mg\dot{h} + mV_{TAS}\dot{V}_{TAS}$$

この物理モデルを基盤として、FMSは各Waypointにおける通過高度や速度を逆算（Backward Propagation）し、最適な降下開始点（Top of Descent: TOD）や減速プロファイルを決定する。

---

## 2. LNAV（水平航法）：旋回開始点と経路遷移ロジック

水平面におけるWaypointの通過目標値、特に「旋回開始点（Turn Start Point）」または「旋回予期点（Turn Anticipation Point）」の算出は、航空機が不連続な直線経路（Leg）間を滑らかに接続するために不可欠である。現代の航法では、Waypoint上空を通過してから旋回する「Fly-Over」方式と、手前で旋回を開始し経路を短絡する「Fly-By」方式が明確に区別され、それぞれの幾何学的定義に基づいて目標座標が計算される。

### 2.1 Fly-By ウェイポイントにおける旋回予期距離（DTA）の算出

Fly-By遷移において、FMSは次のレグへ接線方向に乗る（Tangential Intercept）ための円弧を計算し、その円弧の始点を旋回開始点として特定する。この計算において最も重要な変数は、対地速度（Ground Speed: $V_{GS}$）、バンク角（Bank Angle: $\phi$）、および変針角（Track Change Angle: $\alpha$）である。

### 2.1.1 旋回半径の導出

旋回半径（$R$）は、機体に作用する遠心力と揚力の水平成分の釣り合いから導出される。FMSは対気速度ではなく、風の影響を考慮した対地速度（$V_{GS}$）を用いて、地表面上の旋回半径を計算する。

$$R = \frac{V_{GS}^2}{g \cdot \tan(\phi_{nom})}$$

ここで、$\phi_{nom}$はFMSが決定した公称バンク角である。この式から、対地速度の二乗に比例して旋回半径が増大することが示唆される。したがって、強い追い風（Tailwind）が存在する場合、$V_{GS}$が増加し、旋回半径が拡大するため、FMSはより手前の地点を旋回開始点として設定するロジックとなる。

### 2.1.2 旋回予期距離（DTA）の幾何学

旋回開始点は、Waypointからインバウンドコース上を逆算した距離、すなわち「旋回予期距離（Distance of Turn Anticipation: DTA）」として定義される。変針角を$\alpha$（$|\psi_{out} - \psi_{in}|$）とすると、DTAは以下の式で表される。

$$DTA = R \cdot \tan\left(\frac{\alpha}{2}\right)$$

このDTA算出ロジックにより、変針角が鋭角（大きい角度変更）であるほど、また対地速度が速いほど、Waypointより遥か手前で旋回を開始する必要が生じる。

| **パラメータ変動**           | **物理的影響**                   | **DTAへの影響**          | **運用上の含意**                                 |
| ---------------------------- | -------------------------------- | ------------------------ | ------------------------------------------------ |
| **対地速度 ($V_{GS}$) 上昇** | 旋回半径の拡大 ($R \propto V^2$) | 距離増大（より手前）     | 追い風時や高高度飛行時は旋回開始が早まる。       |
| **バンク角 ($\phi$) 増加**   | 旋回半径の縮小                   | 距離減少（Waypoint寄り） | 旋回性能が高いほど経路の短絡距離は短くなる。     |
| **変針角 ($\alpha$) 増加**   | 接線幾何学の変化                 | 距離増大                 | 急激なコース変更時は大幅な手前からの旋回が必要。 |

### 2.2 バンク角制限ロジックと高高度遷移

FMSは常に最大バンク角を使用するわけではない。乗客の快適性、失速マージン、および機体構造保護の観点から、飛行フェーズに応じたバンク角制限ロジックが組み込まれている。

- **低高度（ターミナルエリア）:** 通常、最大25度または30度に設定される。RNP（Required Navigation Performance）方式では、特定のRF（Radius to Fix）レグに対して固定半径を維持するためのバンク角が動的に計算される。
- **高高度（巡航中）:** 高高度では空気密度が低く、空気力学的減衰（Aerodynamic Damping）が低下するため、また「コフィン・コーナー（失速速度と臨界マッハ数の接近領域）」でのマージン確保のため、バンク角は通常10度〜15度程度に制限される。これにより、高高度での旋回半径は極めて大きくなり、数十マイル手前から旋回を開始するケースも発生する。

### 2.3 状態遷移とバイパスロジック

オートパイロットのシーケンス制御は有限オートマトン（Finite State Machine）として実装される。航空機が計算されたDTA圏内に入ると、状態は「直線飛行（Leg Following）」から「旋回遷移（Turn Transition）」へと移行する。

**バイパス（Bypass）判定:**
DTAが直前のレグ長（Leg Length）よりも長くなる場合、物理的にそのレグを飛行する前に旋回を開始しなければならないという矛盾が生じる。この場合、FMSのロジックは当該Waypointを「スキップ」し、さらに一つ先のWaypointへのインターセプト軌道を生成するか、あるいはコックピットに「経路不連続（Discontinuity）」の警告を発出する。

---

## 3. VNAV（垂直航法）：高度目標値の算出と制約解決

垂直航法（VNAV）における各Waypointの高度目標値算出は、LNAVのような単純な幾何計算ではなく、エネルギー管理と制約条件の解決を伴う複雑な最適化問題である。FMSは、目的地から逆方向（Backwards）に計算を行う「バックワード・プロパゲーション（Backward Propagation）」手法を用いて、巡航高度からの降下パスを構築する。

### 3.1 パス構築モード：Geometric vs. Performance

高度目標の算出ロジックは、大きく分けて二つのモードに分類される。

### 3.1.1 幾何学的パス（Geometric Path / VNAV PTH）

高度制約のある二点間を直線で結ぶロジックである。

- **算出式:** 始点高度$h_1$と終点高度$h_2$、水平距離$D$から、一定の降下角（Flight Path Angle: $\gamma$）を算出する。
  $$\gamma = \arctan\left(\frac{h_1 - h_2}{D}\right)$$
- **特性:** エンジン推力に関わらず、幾何学的な「レール」に沿って飛行する。物理的に降下が困難な場合（減速が間に合わない等）でもパスを維持しようとするため、ドラッグ（スピードブレーキ）の使用が要求される場合がある。

### 3.1.2 性能パス（Performance Path / Idle Descent）

エンジン推力をアイドル（Idle）とした場合の、機体固有の滑空比に基づく自然な降下プロファイルである。

- **算出ロジック:** 機体の抗力係数（$C_D$）と質量を基に、運動方程式を積分して高度変化を予測する。
- **特性:** 燃料消費が最小となるが、風や重量の誤差により、特定のWaypointで高度が変動する可能性がある。

### 3.2 高度制約の解決アルゴリズム（Constraint Solver）

Waypointには、「AT（定点）」、「AT OR ABOVE（以上）」、「AT OR BELOW（以下）」、「WINDOW（範囲）」といった高度制約が付与される。FMSはこれらを数学的な不等式として扱い、以下のロジックで目標高度を決定する。

1. **アンカーポイント設定:** 滑走路またはFAF（最終進入フィックス）を起点（高度・速度固定）とする。
2. **逆方向積分:** アイドル推力を仮定し、一つ手前のWaypointまでの高度上昇量を計算する。
3. **制約判定:**
   - 計算された高度が制約範囲内であれば、その高度を目標値（Target Altitude）として採用する。
   - **制約違反（Too Low）:** 計算高度が「AT OR ABOVE」を下回る場合、その制約高度を新たな「アンカー」として設定し、パスを持ち上げる（幾何パス化、または推力追加）。
   - **制約違反（Too High）:** 計算高度が「AT OR BELOW」を上回る場合、制約高度まで強制的に下げる。これによりパスが急勾配となる場合、「DRAG REQUIRED」等のメッセージが出力される。

**アルゴリズム概略（擬似コード的表現）：**

Current_Anchor = Runway_Threshold

For each Leg (from Last to First):

Project_Idle_Path(from: Current_Anchor, to: Previous_Waypoint)

Calculated_Alt = Result_of_Projection

`If Calculated_Alt violates Constraints:
    Resolve_Conflict()
    Set Target_Alt = Constrained_Limit
    Update Current_Anchor = Target_Alt (Geometric Segment created)
Else:
    Set Target_Alt = Calculated_Alt (Idle Segment maintained)`

### 3.3 降下開始点（Top of Descent: TOD）の反復計算

TODは、巡航フェーズから降下フェーズへの遷移点であり、燃料効率に直結する重要なパラメータである。パイロットは簡易的に「3:1ルール（高度1000ftにつき3NM）」を用いるが、FMSはより厳密な物理演算を行う。

FMSは、TODの位置を決定するために**反復法（Iterative Method）**を用いる。

1. **初期推定:** 3度のパスなどを仮定してTODの概略位置（$S_{TOD}$）を設定。
2. **フォワード・シミュレーション:** そのTODからアイドル降下をシミュレーション。
3. **誤差評価:** 最初の制約点（Bottom of Descent）における高度誤差$\Delta h$を算出。
4. **修正:** $\Delta h$がゼロに収束するまで、$S_{TOD}$の位置を修正し再計算を行う。

$$S_{TOD}^{(k+1)} = S_{TOD}^{(k)} + K \cdot (h_{simulated} - h_{constraint})$$

### 3.4 BADAエネルギー配分係数（Energy Share Factor）

降下中、機体は高度を下げる（位置エネルギーの減少）と同時に、減速（運動エネルギーの減少）を行う必要がある。BADAモデル等では、余剰エネルギー（$T-D$）を高度変化と速度変化にどう配分するかを決定するために、**エネルギー配分係数（Energy Share Factor: ESF）**が用いられる。

$$ESF = \left(1 + \frac{V_{TAS}}{g} \cdot \frac{dV_{TAS}}{dh}\right)^{-1}$$

降下率（ROCD）は以下の式で決定される：

$$ROCD = \frac{(T - D)V_{TAS}}{mg} \cdot ESF$$

- **一定マッハ数降下:** 音速は高度低下に伴い増加（気温上昇のため）するため、一定マッハ数を維持するにはTASを減少させる必要がある。この場合、$dV/dh > 0$となり、ESFは運動エネルギーの減少分を降下率の増加に転換するよう作用する。
- **一定CAS降下:** 低高度で一定CASを維持する場合も同様にTASは減少するが、その勾配は異なる。FMSはこのESFを用いて、減速しながらどの程度のレートで降下できるかを精密に予測する。

---

## 4. 速度および時間管理のロジック

各Waypointにおける目標速度は、単なる制限速度ではなく、コストインデックス（CI）や到着時刻制約（RTA）に基づく最適化の結果として算出される。

### 4.1 速度スケジュールとクロスオーバー高度

ジェット機の運用では、低高度のCAS（較正対気速度）と高高度のマッハ数（Mach）が使い分けられる。FMSは、これらが等価となる**クロスオーバー高度（Crossover Altitude）**を常に計算している。

- **上昇時:** 一定CASで上昇すると、高度とともにマッハ数が増加する。目標マッハ数（例: M0.78）に到達した時点で、制御モードをCASホールドからMachホールドへ切り替える。
- **降下時:** 逆に、一定マッハ数で降下し、CASが制限値（例: 300kt）に達した高度でCASホールドへ切り替える。

この切り替えロジックは、以下の等式が成立する圧力を解くことで実装される：

$$V_{TAS}(CAS, Pressure) = V_{TAS}(Mach, Temperature)$$

### 4.2 コストインデックス（CI）による最適化

目標速度は、運航コスト$J$を最小化するように決定される。コストインデックス（CI）は、時間のコストと燃料のコストの比率である。

$$J = \text{Fuel Burn} + (CI \times \text{Time})$$

- **CI = 0:** 燃料最小化（Maximum Range Cruise）。低速で飛行し、滞空時間を気にしない。
- **CI = High:** 時間最小化。Vmo/Mmo（最大運用速度）付近で飛行する。

FMSは各Waypoint間の風成分（Headwind/Tailwind）を考慮し、向かい風では速度を上げ（露出時間の短縮）、追い風では速度を下げる（燃料節約）よう、目標速度を微調整する。

### 4.3 RTA（要求到着時刻）の制御ループ

4次元軌道運用において、特定のWaypointに指定時刻（$T_{RTA}$）に到達する必要がある場合、FMSは速度を調整変数としたフィードバック制御を行う。

**RTA制御アルゴリズム:**

1. **予測:** 現在の速度計画に基づき、到着予定時刻（$T_{ETA}$）を計算。
2. **誤差検出:** 時間誤差 $\Delta t = T_{RTA} - T_{ETA}$ を算出。
3. **速度補正:** 誤差を解消するために必要な速度変更量（Speed Modification）を計算し、目標速度に加算する。

   $$V_{target} = V_{ECON} + K_p \cdot \Delta t$$

   ここで$K_p$は比例ゲインである。

4. **制限:** 補正後の速度が機体性能限界（$V_{min}, V_{max}$）を超えないようリミッターをかける。達成不可能な場合は「RTA UNABLE」を通知する。

---

## 5. 大気モデルと統合ロジック

これら全ての計算（LNAVの旋回半径、VNAVの降下パス、RTAの速度）は、正確な対地速度（$V_{GS}$）と真対気速度（$V_{TAS}$）の推定に依存しており、その根幹には大気モデルがある。

### 5.1 風と気温の補間（Interpolation）

FMSには、主要なWaypointと高度における予報風（Forecast Wind）と気温が入力される。FMSはこれらを格子点データとして保持し、航空機の現在位置および将来のWaypointにおける大気状態を推定するために**線形補間（Linear Interpolation）**を行う。

- **垂直補間:** 入力された高度層間の風を補間する。
- **水平補間:** Waypoint間の距離（Along-Track Distance）に基づいて風を補間する。

風の予報誤差は、$V_{GS}$の計算誤差に直結し、結果としてLNAVの旋回開始位置のズレや、VNAVのパス乖離（High/Low）を引き起こす主要因となる。したがって、最新のFMSでは、実際に計測した風（Actual Wind）と予報風をブレンド（Wind Blending）し、前方のモデルを動的に更新するロジックが採用されている。

---

## 6. 結論

オートパイロットにおける各Waypointの目標値算出は、単一の数式ではなく、相互に依存する複数のアルゴリズムの統合によって実現されている。

1. **LNAV**は、対地速度とバンク角制限に基づく幾何学計算により、Fly-By遷移のための旋回開始点を決定する。
2. **VNAV**は、エネルギー保存則とESFを用いた物理シミュレーションを逆方向に実行し、高度制約を満たす最適なアイドル降下パスを構築する。
3. **速度**は、空力限界、法的制約、および経済性（CI）のバランスによって決定され、RTA運用時には時間制約を満たすための操作変数として機能する。

これらのロジックは、常に変動する気象条件やATCからの変更指示に対し、リアルタイムで再計算（Re-prediction）を行い、4次元的に整合性の取れた飛行軌道を維持し続けている。
